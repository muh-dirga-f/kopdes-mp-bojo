<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Anggota</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#modalAdd">
            <i class="fas fa-plus"></i> Tambah
        </button>
    </div>

    <!-- TABEL ANGGOTA AKTIF (sudah ada) -->
    <div class="card shadow">
        <div class="card-body">
            <table id="tblMembers" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Nomor</th>
                        <th>Nama</th>
                        <th>HP</th>
                        <th>Email</th>
                        <th>WAJIB</th>
                        <th>POKOK</th>
                        <th style="width:140px;">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% members.forEach(m=> { %>
                        <tr>
                            <td>
                                <%= m.memberNumber %>
                            </td>
                            <td>
                                <%= m.fullName %>
                            </td>
                            <td>
                                <%= m.phone || '-' %>
                            </td>
                            <td>
                                <%= m.email || '-' %>
                            </td>
                            <td>
                                <%= m.wajibFormatted %>
                            </td>
                            <td>
                                <%= m.pokokFormatted %>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info btn-edit" data-toggle="modal"
                                    data-target="#modalEdit" data-id="<%= m.id %>"
                                    data-membernumber="<%- (m.memberNumber || '').replace(/"/g,'&quot;') %>"
                                    data-fullname="<%- (m.fullName || '' ).replace(/"/g,'&quot;') %>"
                                        data-phone="<%- (m.phone || '' ).replace(/"/g,'&quot;') %>"
                                            data-email="<%- (m.email || '' ).replace(/"/g,'&quot;') %>"
                                                data-address="<%- (m.address || '' ).replace(/"/g,'&quot;') %>"
                                                    ><i class="fas fa-edit"></i></button>

                                <form method="post" action="/members/<%= m.id %>/delete" class="d-inline"
                                    onsubmit="return confirm('Nonaktifkan anggota ini?')">
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-user-slash"></i></button>
                                </form>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ====== TABEL ANGGOTA NONAKTIF ====== -->
    <div class="card shadow mt-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Anggota Nonaktif</h6>
        </div>
        <div class="card-body">
            <table id="tblMembersInactive" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Nomor</th>
                        <th>Nama</th>
                        <th>HP</th>
                        <th>Email</th>
                        <th>WAJIB</th>
                        <th>POKOK</th>
                        <th style="width:120px;">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% (membersInactive || []).forEach(m=> { %>
                        <tr>
                            <td>
                                <%= m.memberNumber %>
                            </td>
                            <td>
                                <%= m.fullName %>
                            </td>
                            <td>
                                <%= m.phone || '-' %>
                            </td>
                            <td>
                                <%= m.email || '-' %>
                            </td>
                            <td>
                                <%= m.wajibFormatted %>
                            </td>
                            <td>
                                <%= m.pokokFormatted %>
                            </td>
                            <td>
                                <form method="post" action="/members/<%= m.id %>/activate" class="d-inline"
                                    onsubmit="return confirm('Aktifkan kembali anggota ini?')">
                                    <button class="btn btn-sm btn-success"><i class="fas fa-user-check"></i>
                                        Aktifkan</button>
                                </form>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Tambah -->
<div class="modal fade" id="modalAdd" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" method="post" action="/members">
            <div class="modal-header">
                <h5 class="modal-title">Tambah Anggota</h5>
                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>Nama Lengkap</label><input name="fullName" class="form-control" required>
                </div>
                <div class="form-group"><label>HP</label><input name="phone" class="form-control"></div>
                <div class="form-group"><label>Email</label><input name="email" type="email" class="form-control"></div>
                <div class="form-group"><label>Alamat</label><textarea name="address" class="form-control"
                        rows="3"></textarea></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">Batal</button>
                <button class="btn btn-primary">Simpan</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Edit -->
<div class="modal fade" id="modalEdit" tabindex="-1">
    <div class="modal-dialog">
        <form id="formEdit" class="modal-content" method="post">
            <div class="modal-header">
                <h5 class="modal-title">
                    Edit Anggota
                    <small class="text-muted ml-2" id="view-memberNumber"></small>
                </h5>
                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>Nama Lengkap</label><input id="e-fullName" name="fullName"
                        class="form-control" required></div>
                <div class="form-group"><label>HP</label><input id="e-phone" name="phone" class="form-control"></div>
                <div class="form-group"><label>Email</label><input id="e-email" name="email" type="email"
                        class="form-control"></div>
                <div class="form-group"><label>Alamat</label><textarea id="e-address" name="address"
                        class="form-control" rows="3"></textarea></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">Batal</button>
                <button class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<script>
    $(function () {
        $('#tblMembers').DataTable({
            pageLength: 10,
            lengthMenu: [10, 25, 50, 100],
        });

        $('#tblMembersInactive').DataTable({
            pageLength: 10,
            lengthMenu: [10, 25, 50, 100]
        });

        // isi modal Edit dari data-attribute tombol
        $(document).on('click', '.btn-edit', function () {
            const btn = $(this);
            $('#formEdit').attr('action', '/members/' + btn.data('id'));
            $('#view-memberNumber').text(btn.data('membernumber'));
            $('#e-fullName').val(btn.data('fullname'));
            $('#e-phone').val(btn.data('phone'));
            $('#e-email').val(btn.data('email'));
            $('#e-address').val(btn.data('address'));
        });
    });
</script>